!function(){"use strict";!function(){function e(e){this.value=e}function i(i){function a(n,t){try{var r=i[n](t),l=r.value;l instanceof e?Promise.resolve(l.value).then(function(e){a("next",e)},function(e){a("throw",e)}):s(r.done?"return":"normal",r.value)}catch(e){s("throw",e)}}function s(e,i){switch(e){case"return":n.resolve({value:i,done:!0});break;case"throw":n.reject(i);break;default:n.resolve({value:i,done:!1})}(n=n.next)?a(n.key,n.arg):t=null}var n,t;this._invoke=function(e,i){return new Promise(function(s,r){var l={key:e,arg:i,resolve:s,reject:r,next:null};t?t=t.next=l:(n=t=l,a(e,i))})},"function"!=typeof i.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(i.prototype[Symbol.asyncIterator]=function(){return this}),i.prototype.next=function(e){return this._invoke("next",e)},i.prototype.throw=function(e){return this._invoke("throw",e)},i.prototype.return=function(e){return this._invoke("return",e)}}();var e=function(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")},i=function(){function e(e,i){for(var a=0;a<i.length;a++){var s=i[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(i,a,s){return a&&e(i.prototype,a),s&&e(i,s),i}}();!function(a){new(function(){function s(){e(this,s),this.init()}return i(s,[{key:"switchMode",value:function(){var e=this;this.$createAccount.on("change",function(){e.$createAccount.is(":checked")?(e.$signupFields.addClass("hidden"),e.$createAccountFields.removeClass("hidden")):(e.$signupFields.removeClass("hidden"),e.$createAccountFields.addClass("hidden"))})}},{key:"verifyEmail",value:function(){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(this.email)}},{key:"emailRegChange",value:function(){var e=this;this.$regEmail.on("change",function(){e.email=e.$regEmail.val(),""===e.email||e.verifyEmail()?(e.removeInvalidRegEmail(),e.ajaxCheckEmail()):(e.$invalidRegEmail.html(e.invalidEmail),e.showInvalidRegEmail())})}},{key:"userSignInChange",value:function(){var e=this;this.$userLogin.on("change",function(){""!==e.$userLogin.val()?e.removeInvalidUser():(e.$invalidUser.html(e.invalidUser),e.showInvalidUser())})}},{key:"passwordChange",value:function(){var e=this;this.$password.on("change",function(){e.password=e.$password.val(),""===e.password?e.showInvalidPassword():e.removeInvalidPassword()})}},{key:"showInvalidRegEmail",value:function(){this.$invalidRegEmail.removeClass("hidden"),this.$regEmail.closest(".form-item").addClass("validate-required")}},{key:"removeInvalidRegEmail",value:function(){this.$invalidRegEmail.addClass("hidden"),this.$regEmail.closest(".form-item").removeClass("validate-required")}},{key:"showInvalidPassword",value:function(){this.$invalidPassword.removeClass("hidden"),this.$password.closest(".form-item").addClass("validate-required")}},{key:"removeInvalidPassword",value:function(){this.$invalidPassword.addClass("hidden"),this.$password.closest(".form-item").removeClass("validate-required")}},{key:"showInvalidUser",value:function(){this.$invalidUser.removeClass("hidden"),this.$invalidUser.closest(".form-item").addClass("validate-required")}},{key:"removeInvalidUser",value:function(){this.$invalidUser.addClass("hidden"),this.$invalidUser.closest(".form-item").removeClass("validate-required")}},{key:"ajaxCheckEmail",value:function(){var e=this;if(this.$createAccount.is(":checked")){if(""===this.email)return!1;if(this.aRegisterdUsername.length&&-1!==_.indexOf(this.aRegisterdUsername,this.username))return this.$invalidRegEmail.html(this.aErrorEmailMessage[this.email]),this.showInvalidRegEmail(),!1;!1!==this.xhrCheckEmail&&200!==this.xhrCheckEmail.status&&this.xhrCheckEmail.abort(),this.xhrCheckEmail=a.ajax({type:"POST",url:WILOKE_GLOBAL.ajaxurl,data:{security:WILOKE_GLOBAL.wiloke_nonce,action:"wiloke_verify_email",email:this.email},success:function(i){i.success?e.removeInvalidRegEmail():(e.aRegistedEmail.push(e.email),e.aErrorEmailMessage[e.email]=i.data.message,e.$invalidRegEmail.html(i.data.message),e.showInvalidRegEmail(),a("#wiloke-form-preview-listing").trigger("stopping_upload"))}})}}},{key:"processSignUpSignIn",value:function(){var e=this,i=this;this.$btnSignIn.on("click",function(){event.preventDefault();var s=!1,n=i.$userLogin.val(),t=i.$password.val();""===n&&(i.showInvalidUser(),s=!0),""===t&&(e.showInvalidPassword(),s=!0),!1===s&&(!1!==e.xhrSignIn&&200!==e.xhrSignIn.status&&e.xhrSignIn.abort(),e.$btnSignIn.addClass("loading"),e.xhrSignIn=a.ajax({type:"POST",url:WILOKE_GLOBAL.ajaxurl,data:{action:"wiloke_signin",security:WILOKE_GLOBAL.wiloke_nonce,userlogin:n,password:t},success:function(i){i.success?e.$signUpSignInWrapper.html(i.data.message):e.$invalidAccountMessage.html(i.data.message).removeClass("hidden"),e.$btnSignIn.removeClass("loading"),a("body").data("WilokeUserLoggedIn",!0)}}))})}},{key:"init",value:function(){this.aRegistedEmail=[],this.aRegisterdUsername=[],this.aErrorEmailMessage=[],this.email="",this.username="",this.password="",this.xhrCheckEmail=!1,this.xhrSignIn=!1,this.$createAccount=a("#createaccount"),this.newNonce=null,this.$signupFields=a(".signup-account-fields"),this.$createAccountFields=a(".create-account-fields"),this.$passwordField=a(".password-field"),this.$signUpSignInWrapper=a("#wiloke-signup-signin-wrapper"),this.$invalidPassword=a("#wiloke-invalid-password"),this.$invalidUser=a("#wiloke-invalid-user"),this.invalidUser=this.$invalidUser.html(),this.$userLogin=a("#wiloke-user-login"),this.$password=a("#wiloke-my-password"),this.$btnSignIn=a("#wiloke-signin-account"),this.$invalidAccountMessage=a("#wiloke-signup-failured"),this.$invalidRegEmail=a("#wiloke-reg-invalid-email"),this.invalidEmail=this.$invalidRegEmail.html(),this.$regEmail=a("#wiloke-reg-email"),this.emailRegChange(),this.passwordChange(),this.processSignUpSignIn(),this.userSignInChange(),this.$createAccount.length&&this.switchMode()}}]),s}())}(jQuery)}();
